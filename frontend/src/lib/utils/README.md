# MIDI Track Naming Solution

This directory contains utilities to solve the issue where MIDI files generated by ScribbleTune show up as "Track 0" when imported into DAWs.

## Problem

When ScribbleTune generates MIDI files, they don't include track name meta events. DAWs like Ableton Live, Logic Pro, and others rely on these meta events to display meaningful track names. Without them, tracks default to generic names like "Track 0".

## Solution

We've implemented a monkey patch solution that automatically adds track names to MIDI files after they're generated by ScribbleTune.

### Files

- **`midi-track-namer.ts`**: Core utility functions for adding track name meta events to MIDI files
- **`scribbletune-patch.ts`**: Monkey patch that intercepts ScribbleTune.midi calls and adds track names

### How It Works

1. **Automatic Patching**: When any generator imports the patch, ScribbleTune.midi is automatically replaced with a patched version
2. **Track Name Extraction**: Track names are automatically extracted from filenames (e.g., "01a_kick.mid" → "Kick")
3. **MIDI Modification**: The patched function adds a "Track Name" meta event to the generated MIDI file
4. **Transparent Operation**: The original ScribbleTune.midi API remains unchanged

### Usage

No changes needed in your generator code! Simply import the patch in your generator files:

```typescript
import ScribbleTune from 'scribbletune';
// Import the patched ScribbleTune to enable automatic track naming
import '../utils/scribbletune-patch';

// Your existing code works unchanged
ScribbleTune.midi(clip, outputPath, bpm);
```

### Track Name Rules

Track names are automatically generated from filenames using these rules:

- **Remove extension**: `01a_kick.mid` → `01a_kick`
- **Extract last part**: `01a_kick` → `kick` (after last underscore)
- **Capitalize**: `kick` → `Kick`

Examples:
- `01a_kick.mid` → "Kick"
- `02_bass.mid` → "Bass" 
- `03_lead_melody.mid` → "Lead Melody"
- `chords_pads.mid` → "Chords Pads"

### Custom Track Names

You can also specify custom track names by using the enhanced API:

```typescript
import { scribbleTuneMidiWithTrackName } from '../utils/scribbletune-patch';

scribbleTuneMidiWithTrackName(clip, outputPath, bpm, "My Custom Track Name");
```

## Technical Details

The solution works by:

1. **Intercepting MIDI Generation**: The patch replaces `ScribbleTune.midi` with a wrapper function
2. **Calling Original Function**: The original ScribbleTune.midi is called to generate the MIDI file
3. **Adding Meta Events**: After generation, the file is modified to include a "Track Name" meta event
4. **MIDI Format Support**: Works with Type 0 MIDI files (single track) which is what ScribbleTune generates

The track name meta event is added at the beginning of the track data, ensuring DAWs will recognize it when importing the file.

## Testing

To verify the solution works:

1. Generate MIDI files using any of the generators
2. Import the generated MIDI files into your DAW
3. Check that tracks are named according to the filename (not "Track 0")

The solution is backward compatible and doesn't affect the existing ScribbleTune API.

